<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="management.userDAO.BookMapper">

	<insert id="insertBook" parameterType="Book">
	insert into book (title, book_id, publisher) values(#{title}, #{book_id}, #{publisher})	
	</insert>
	
	<update id="updateOverdue">
	update bookrental set overdue_date=round(sysdate-(rental_date+7))
	where receive_date is null and sysdate>(rental_date+7)
	</update>	
	
	<select id="findUser" parameterType="String" resultType="User">
	select User_id, name, gisu, classname, user_pw from BookUser where user_id=#{user_id}
	</select>
	
	<select id="findbook" parameterType="String" resultType="Book">
	select b.book_id, b.title, b.publisher, nvl(f.name,' ' )as rental_name, nvl(s.name, ' ') as reserve_name, 
	r.rental_date, r.receive_date, r.overdue_date
 	from book b full outer join bookrental r on b.book_id=r.book_id 
 	left outer join bookuser f on r.rentalUser_id=f.user_id
 	left outer join bookuser s on r.reserve_id=s.user_id
	where b.title like '%#{title}%'
	</select>
	
	<delete id="deletebook" parameterType="Book">
	delete from Book where book_id=#{book_id}
	</delete>
	
	<select id="findAllbook" resultType="Book">
	select b.book_id, b.title, b.publisher, nvl(f.name,' ' )as rental_name, nvl(s.name, ' ') as reserve_name, 
	r.rental_date, r.receive_date, r.overdue_date
 	from book b full outer join bookrental r on b.book_id=r.book_id 
 	left outer join bookuser f on r.rentalUser_id=f.user_id
 	left outer join bookuser s on r.reserve_id=s.user_id
	</select>
	
	<select id="findRentalBook" resultType="Book">
	select b.book_id, b.title, b.publisher, nvl(f.name,' ' )as rental_name, nvl(s.name, ' ') as reserve_name, 
	r.rental_date, r.receive_date, r.overdue_date
 	from book b join bookrental r on b.book_id=r.book_id 
 	left outer join bookuser f on r.rentalUser_id=f.user_id
 	left outer join bookuser s on r.reserve_id=s.user_id
 	where r.receive_date is null
	</select>
	
	<select id="findOverdueBook" resultType="DBvo">
	select b.book_id, b.title, b.publisher, f.name as "rental_name", 
	s.name as "reserve_name", r.rental_date, r.overdue_date
 	from book b join bookrental r on b.book_id=r.book_id 
 	join bookuser f on r.rentalUser_id=f.user_id 
 	join bookuser s on r.reserve_id=s.user_id
 	where overdue_date>0
	</select>
	
	
</mapper>
